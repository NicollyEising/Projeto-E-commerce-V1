<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Perfil</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
    integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
    integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://kit.fontawesome.com/7805d04e4e.js" crossorigin="anonymous"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
    integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
    integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://kit.fontawesome.com/7805d04e4e.js" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>


  <style>
    .search-input {
      width: 100vh;
      /* Defina a largura desejada */
    }

    img {
      width: 20vh;
      margin: auto;
      margin-top: 2vh;
    }

    .row {
      margin-top: 5vh;
    }


    .search-input {
      width: 100vh;
      /* Defina a largura desejada */
    }

    a {
      text-decoration: none;
      color: black;
    }

    .list-group {
      background-color: #f9f9f9;
      border-radius: 1rem;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      padding: 20px;
      color: #000;
    }

    .list-group-item {
      background-color: #f9f9f9;
      border: none;
      /* Remove a borda */

    }

    button {
      margin-top: 1vh;
      ;
    }


    .nav-item:hover {
      background-color: gray;
    }

    .search-input {
      border-radius: 40px;
    }
  </style>
</head>

<body>


  <nav class="navbar navbar-dark bg-dark">
    <div class="container justify-content-center">
      <form class="d-flex" onsubmit="pesquisarPorNome(event);">
        <input class="form-control me-2 search-input mt-2" id="inputNome" type="search" placeholder="Buscar"
          aria-label="Search">
        <button class="btn text-light" type="submit"><i class="fa-solid fa-magnifying-glass"
            style="font-size: 1.3em;"></i></button>
      </form>
    </div>
  </nav>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark ">
    <div class="container">
      <button onclick="pesquisarPorNome()" class="navbar-toggler" type="button" data-bs-toggle="collapse"
        data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
        aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>


      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mx-auto me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" th:href="@{/index}">Inicio</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" th:href="@{/listaDesejos}">Favoritos</a>
          </li>
          <li class="nav-item dropdown  ">
            <a class="nav-link dropdown-toggle active" href="#" id="navbarDropdown" role="button"
              data-bs-toggle="dropdown" aria-expanded="false">
              Genero
            </a>
            <ul class="dropdown-menu text-light bg-dark" aria-labelledby="navbarDropdown">
              <li><a class="dropdown-item text-light" th:href="@{/index}" name="genero" value="F"
                  onclick="filtrarGenero('F')">Feminino</a></li>
              <li><a class="dropdown-item text-light" th:href="@{/index}" name="genero" value="F"
                  onclick="filtrarGenero('M')">Masculino</a></li>
            </ul>
          </li>
          <li class="nav-item dropdown  ">
            <a class="nav-link dropdown-toggle active" href="#" id="navbarDropdown" role="button"
              data-bs-toggle="dropdown" aria-expanded="false">
              Marcas
            </a>
            <ul class="dropdown-menu text-light bg-dark" aria-labelledby="navbarDropdown">
              <li><a class="dropdown-item text-light" th:href="@{/index}" name="marca" value="Nike"
                  onclick="filtrarMarca('Nike')">Nike</a></li>
              <li><a class="dropdown-item text-light" th:href="@{/index}" name="marca" value="Adidas"
                  onclick="filtrarMarca('Adidas')">Adidas</a></li>
              <li><a class="dropdown-item text-light" th:href="@{/index}" hname="marca" value="Puma"
                  onclick="filtrarMarca('Puma')">Puma</a></li>
            </ul>
          </li>
          <li class="nav-item">
            <a class="nav-link active" th:href="@{/carrinhoDeCompras} ">Carrinho</a>
          </li>

          <li class="nav-item">
            <a class="nav-link active" th:href="@{/login} ">Entrar</a>
          </li>
        </ul>

      </div>
    </div>
  </nav>





  <div class="container-fluid">

    <div class="row justify-content-center mt-5">
      <div class="col-sm-2  m-5">
        <!--card foto-->
        <div class="card mb-3">
          <img src="https://www.pikpng.com/pngl/b/283-2837538_login-icon-line-icons-iconscout-login-icon-images.png"
            class="rounded" alt="...">
          <div class="card-body">
            <h5 class="card-title" id="userCardTitle">Name</h5>
            <h6 class="cardptitle" id="emailCardTitle"></h6>
            <p class="card-text">This is a wider card with supporting text below as a natural lead-in to additional
              content. This content is a little bit longer.</p>
            <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>
          </div>
        </div>
      </div>
      <!--card editar perfil-->
      <div class="col-sm-7 row">
        <div class="card mb-4">
          <div class="card-body p-0">
            <h5 class="card-title mt-4">Editar Perfil</h5>
          </div>
        </div>
        <div class="card">
          <div class="card-body">
            <form class="row  needs-validation" id="editForm" novalidate>
              <div class="col-md-4 position-relative">
                <label for="validationTooltip01" class="form-label">Nome</label>
                <input type="text" class="form-control" id="username" name="username" value="" required>
                <div class="valid-tooltip">
                  OK!
                </div>
              </div>
              <div class="col-md-4 position-relative">
                <label for="validationTooltip02" class="form-label">Email</label>
                <input type="text" class="form-control" id="email" name="email" value="" required>
                <div class="valid-tooltip">
                  OK!
                </div>
              </div>
              <div class="col-md-4 position-relative">
                <label for="validationTooltip03" class="form-label">Senha</label>
                <input type="password" class="form-control" id="password" name="password" required>
                <div class="invalid-tooltip">
                  Por favor, forneça uma senha válida.
                </div>
              </div>
              <div class="col-md-6 position-relative">
                <label for="validationTooltip03" class="form-label">Endereco</label>
                <input type="text" class="form-control" id="endereco" name="endereco" required>
                <div class="invalid-tooltip">
                  Por favor, forneça um endereço válido.
                </div>
              </div>
              <div class="col-md-3 position-relative">
                <label for="validationTooltip04" class="form-label">Genero</label>
                <select class="form-select" id="sexo" name="sexo" required>
                  <option value="F">Feminino</option>
                  <option value="M">Masculino</option>
                </select>
                <div class="invalid-tooltip">
                  Por favor, forneça um genero válido.
                </div>
              </div>
              <div class="col-md-3 position-relative">
                <label for="validationTooltip05" class="form-label">Telefone</label>
                <input type="number" class="form-control" id="telefone" name="telefone" required>
                <div class="invalid-tooltip">
                  Por favor, forneça um número de telefone válido.
                </div>
              </div>
              <div class="col-md-3 position-relative">
                <label for="validationTooltip05" class="form-label">Nascimento</label>
                <input type="date" class="form-control" id="nascimento" name="nascimento" required>
                <div class="invalid-tooltip">
                  Por favor, forneça um número de telefone válido.
                </div>
              </div>
              <div class="col-md-9 position-relative">
                <label for="formFile" class="form-label">Imagem</label>
                <input class="form-control" type="file" id="formFile" disabled>
              </div>
              <div class="d-grid gap-2 d-md-flex justify-content-end mt-2">
                <span id="botao"></span>
                <button class="btn btn-dark " type="submit">Salvar</button>
                <button class="btn btn-dark  logoutBtn" id="logoutBtn">Logout</button>
              </div>
            </form>

          </div>
        </div>

        <div class="container">

        </div>
      </div>








      <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
      <script>
        document.addEventListener('DOMContentLoaded', () => {

          const urlParams = new URLSearchParams(window.location.search);
          const userId = urlParams.get('id');
          verificarAdm(userId);
          // Buscar os dados do usuário
          axios.get(`http://localhost:8080/users/getUserById/${userId}`)
            .then(response => {
              const user = response.data;
              document.getElementById('username').value = user.username;
              document.getElementById('email').value = user.email;
              document.getElementById('password').value = user.password;
              document.getElementById('endereco').value = user.endereco;
              document.getElementById('sexo').value = user.sexo;
              // Formatação da data de nascimento para o formato 'YYYY-MM-DD'
              const formattedDate = new Date(user.nascimento).toISOString().substring(0, 10);
              document.getElementById('nascimento').value = formattedDate;
              document.getElementById('telefone').value = user.telefone;

              document.getElementById('userCardTitle').innerText = user.username;
              document.getElementById('userCardTitle').innerText = user.username;

              document.getElementById('userCardTitle').innerText = user.username;

            })
            .catch(error => {
              console.error('Erro ao buscar usuário:', error);
            });

          // Enviar os dados atualizados
          document.getElementById('editForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const updatedUser = {
              username: document.getElementById('username').value,
              email: document.getElementById('email').value,
              password: document.getElementById('password').value,
              endereco: document.getElementById('endereco').value,
              sexo: document.getElementById('sexo').value,
              nascimento: document.getElementById('nascimento').value,
              telefone: document.getElementById('telefone').value
            };

            axios.put(`http://localhost:8080/users/editar/${userId}`, updatedUser)
              .then(response => {
                alert('Usuário atualizado com sucesso!');
                window.location.href = '/edicaoPerfil';
              })
              .catch(error => {
                console.error('Erro ao atualizar usuário:', error);
              });
          });
        });

        function pesquisarPorNome(event) {
          event.preventDefault();
          var nome = document.getElementById('inputNome').value;
    
          axios.get('http://localhost:8080/index', {
            params: {
              Name: nome
            }
          })
            .then(response => {
              window.location.href = "/index?Name=" + encodeURIComponent(nome);
            })
            .catch(error => {
              console.error('Erro na requisição:', error);
            });
        }
    



        async function verificarAdm(userId) {
          try {
            const response = await axios.get(`http://localhost:8080/users/checkAdm/${userId}`);

            const result = response.data;

            const adminControlsDiv = document.getElementById('botao'); // Seleciona o elemento com a classe 'botao'

            if (result === 'y') {
              // Criação do botão de administrador
              const a = document.createElement('a');
              a.innerText = 'Admin';
              a.className = 'btn btn-dark me-md-2';
              a.style = 'margin-top: 1vh;' // Classes de estilo do Bootstrap, ajuste conforme necessário
              a.onclick = function () {


                window.location.href = '/gerenciamentoProduto';
              };

              // Adicionar o botão à div de controles administrativos
              adminControlsDiv.appendChild(a);
            } else {
              console.log('Usuário não é administrador.');
            }
          } catch (error) {
            console.error('Erro ao verificar se é administrador:', error);
          }
        }


        document.getElementById('logoutBtn').addEventListener('click', function (event) {
          event.preventDefault(); // Evita que o link recarregue a página (caso seja um link)

          // Limpa o userid (ou qualquer outra informação de sessão que deseje limpar)
          userid = null;
          // Exemplo de limpeza de token de sessão (se necessário)
          // sessionStorage.removeItem('token');

          // Realiza o logout no backend (Spring Boot)
          fetch('/users/logout', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({})
          })
            .then(response => {
              if (!response.ok) {
                throw new Error('Erro ao realizar logout');
              }
              // Redireciona para a página de login após o logout
              window.location.href = '/login'; // Redireciona para a página de login
            })
            .catch(error => {
              console.error('Erro ao realizar logout:', error);
              // Trate o erro conforme necessário
            });
        });
      </script>

</body>

</html>